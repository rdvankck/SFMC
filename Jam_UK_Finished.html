<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jameson UK - Preference Center</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    
    <!-- Custom Fonts -->
    <style>
        @font-face {
            font-family: 'jj2';
            src: 
                url("https://sfmc-images.idlcloud.com/devops/jameson/jj2_bk-webfont.woff") format('woff'),
                url("https://sfmc-images.idlcloud.com/devops/jameson/jj2_bk-webfont.woff2") format("woff2"),
                url("https://sfmc-images.idlcloud.com/devops/jameson/JJ2Bk-Regular.eot") format("eot"),
                url("https://sfmc-images.idlcloud.com/devops/jameson/JJ2Bk-Regular.ttf") format("truetype");
            font-weight: 400;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'jj2';
            src: 
                url("https://sfmc-images.idlcloud.com/devops/jameson/jj2_bd-webfont.woff") format('woff'),
                url("https://sfmc-images.idlcloud.com/devops/jameson/jj2_bd-webfont.woff2") format("woff2"),
                url("https://sfmc-images.idlcloud.com/devops/jameson/jj2_bd-webfont.eot") format("eot"),
                url("https://sfmc-images.idlcloud.com/devops/jameson/jj2_bd-webfont.ttf") format("truetype");
            font-weight: 700;
            font-style: normal;
        }
        
        :root {
            --jameson-green: #154734;
            --jameson-light-green: #1a5740;
            --jameson-gold: #D4AF37;
            --jameson-cream: #F5F5DC;
            --jameson-white: #FFFFFF;
            --jameson-dark: #0F3429;
            
            /* iOS Date Picker Variables */
            --picker-width: 384px;
            --picker-height: 220px;
            --wheel-width: calc(var(--picker-width) / 3);
            --item-height: 40px;
            --visible-items: 5;
            --accent: var(--jameson-green);
            --muted: rgba(21, 71, 52, 0.5);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'jj2', Arial, sans-serif;
            background: linear-gradient(135deg, var(--jameson-green) 0%, var(--jameson-light-green) 100%);
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: var(--jameson-white);
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .hero-section {
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .hero-content {
            position: relative;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 30px;
            opacity: 0.95;
        }
        
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            color: var(--jameson-green);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
           --bs-gutter-x: 0 rem;
        }
        
        .unified-card {
            background: #ffffff;
            padding: 30px;
            margin: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow-x: hidden;
        }
        
        .question-divider {
            border: none;
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(21, 71, 52, 0.1), transparent);
            margin: 25px 0;
        }
        
        .question-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .question-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--jameson-green);
            margin-bottom: 8px;
        }
        
        .question-subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 20px;
        }

        /* Personal Information Styles */
        .personal-info-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'jj2', Arial, sans-serif;
            color: var(--jameson-green);
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .personal-info-input:focus {
            border-color: var(--jameson-green);
            box-shadow: 0 0 0 3px rgba(21, 71, 52, 0.1);
            outline: none;
        }

        /* Desktop DOB Selects */
        .desktop-dob-selects {
            display: none; /* Hide by default for mobile-first approach */
            margin: 20px 0;
        }

        .desktop-dob-selects .form-label {
            display: none; /* Hide labels as requested */
        }

        /* iOS Date Picker Styles */
        .picker-shell {
            width: min(var(--picker-width), 100%);
            height: var(--picker-height);
            border-radius: 14px;
            background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,252,0.95));
            box-shadow: 0 10px 30px rgba(18, 38, 77, 0.12), inset 0 1px 0 rgba(255,255,255,0.6);
            display: flex; /* Show by default for mobile-first approach */
            gap: 0;
            padding: 12px;
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            margin: 20px auto 30px auto;
            max-width: 100%;
        }

        .wheel {
            width: var(--wheel-width);
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            --webkit-overflow-scrolling: touch;
            text-align: center;
            position: relative;
        }

        .wheel::-webkit-scrollbar { 
            width: 0; 
            height: 0; 
        }

        .wheel-list {
            padding: calc((var(--picker-height) / 2) - (var(--item-height) / 2)) 0;
            margin: 0;
            list-style: none;
        }

        .wheel-item {
            height: var(--item-height);
            line-height: var(--item-height);
            scroll-snap-align: center;
            font-size: 16px;
            color: var(--muted);
            transition: color .12s ease, font-weight .12s ease, transform .12s ease;
            font-family: 'jj2', Arial, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0 8px;
        }

        .selection-window {
            pointer-events: none;
            position: absolute;
            left: 12px;
            right: 12px;
            top: calc(50% - var(--item-height) / 2);
            height: var(--item-height);
            border-top: 2px solid rgba(21, 71, 52, 0.3);
            border-bottom: 2px solid rgba(21, 71, 52, 0.3);
            background: rgba(21, 71, 52, 0.05);
            border-radius: 8px;
        }

        .wheel-item.center {
            color: var(--accent);
            font-weight: 700;
            transform: translateY(-1px);
            font-size: 18px;
            opacity: 1 !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .divider {
            width: 1px;
            background: linear-gradient(#0000, rgba(21, 71, 52, 0.1), #0000);
            margin: 0 6px;
            opacity: 0.7;
        }

        .picker-footer {
            position: absolute;
            bottom: -25px;
            left: 12px;
            right: 12px;
            font-size: 14px;
            color: rgba(21, 71, 52, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 500;
        }

        .picker-done-btn {
            background: var(--jameson-green);
            color: white;
            border: 0;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(21, 71, 52, 0.3);
            cursor: pointer;
        }
        
        /* iOS Select Style for other inputs */
        .ios-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            font-size: 16px;
            font-family: 'jj2', Arial, sans-serif;
            color: var(--jameson-green);
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }
        
        .ios-select:focus {
            border-color: var(--jameson-green);
            box-shadow: 0 0 0 3px rgba(21, 71, 52, 0.1);
            outline: none;
        }

        /* Hidden inputs for form submission */
        .hidden-date-inputs {
            display: none;
        }

        /* Football Team Selection Styles */
        .league-selector {
            margin: 20px 0;
            text-align: center;
        }

        .league-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .league-tab {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 25px;
            color: var(--jameson-green);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: 'jj2', Arial, sans-serif;
        }

        .league-tab.active {
            background: var(--jameson-green);
            color: white;
        }

        .league-tab:hover {
            background: var(--jameson-dark);
            color: white;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .team-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .team-card:hover {
            border-color: var(--jameson-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(21, 71, 52, 0.2);
        }

        .team-card.selected {
            border-color: var(--jameson-green);
            background: var(--jameson-green);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(21, 71, 52, 0.3);
        }

        .team-card img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .team-card .team-name {
            font-size: 0.85rem;
            font-weight: 600;
            line-height: 1.2;
        }

        /* Interest Checkboxes */
        .interests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .interest-item {
            position: relative;
        }
        
        /* Checkmark icon for selected items */
        .checkmark-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 13px;
            height: 13px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            color: var(--jameson-green);
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .interest-checkbox:checked + .interest-label .checkmark-icon {
            opacity: 1;
            transform: scale(1);
            color: var(--jameson-green);
            background: white;
        }

        /* Occasions-specific styles for opt-out preferences */
        .occasions-checkbox {
            /* Same as interest-checkbox but for occasions */
        }

        .occasions-checkbox:checked + .interest-label span {
            text-decoration: line-through;
            color: white; /* White text on green background for better contrast */
        }

        .occasions-checkbox:checked + .interest-label .checkmark-icon {
            opacity: 1;
            transform: scale(1);
            color: var(--jameson-green);
            background: white;
        }

        /* Change checkmark to X for occasions */
        .occasions-checkbox:checked + .interest-label .checkmark-icon {
            opacity: 1;
            transform: scale(1);
            color: white; /* White X icon on green background */
            background: var(--jameson-green);
        }

        .occasions-checkbox:checked + .interest-label .checkmark-icon.fa-check::before {
            content: '\f00d'; /* FontAwesome X (times) icon */
        }
        
        .interest-checkbox {
            display: none;
        }
        
        .interest-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 16px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            color: var(--jameson-green);
            min-height: 76px;
            height: auto;
            gap: 8px;
        }
        
        .interest-checkbox:checked + .interest-label {
            background: var(--jameson-green);
            color: white;
            border-color: var(--jameson-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(21, 71, 52, 0.3);
        }
        
        .interest-label:hover {
            border-color: var(--jameson-green);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(21, 71, 52, 0.2);
        }

        /* Location Inputs */
        .location-inputs-row {
            display: flex;
            gap: 25px;
            margin: 25px 0;
            align-items: flex-start;
        }
        
        .postcode-container {
            flex: 1;
            min-width: 250px;
        }
        
        .cities-input-container {
            flex: 1.5;
            min-width: 300px;
        }
        
        .input-label {
            display: block;
            font-weight: 600;
            color: var(--jameson-green);
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .location-input-field {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'jj2', Arial, sans-serif;
            color: var(--jameson-green);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .location-input-field:focus {
            border-color: var(--jameson-green);
            box-shadow: 0 0 0 3px rgba(21, 71, 52, 0.1);
            outline: none;
        }

        .autocomplete-container {
            position: relative;
            display: flex;
            gap: 10px;
            align-items: stretch;
        }
        
        .add-city-btn {
            background: var(--jameson-green);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-family: 'jj2', Arial, sans-serif;
            box-shadow: 0 2px 8px rgba(21, 71, 52, 0.2);
        }
        
        .add-city-btn:hover {
            background: var(--jameson-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(21, 71, 52, 0.3);
        }
        
        .add-city-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .selected-cities {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: start;
            border-radius: 8px;
            margin: 0 auto;
            margin-top: 10px;
            margin-right: 88px;
        }
        
        .city-block {
            background: var(--jameson-green);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(21, 71, 52, 0.2);
            transition: all 0.3s ease;
        }
        
        .city-block:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(21, 71, 52, 0.3);
        }
        
        .city-remove-btn {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            margin-left: 5px;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }
        
        .city-remove-btn:hover {
            opacity: 1;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 70px;
            background: white;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .autocomplete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: rgba(21, 71, 52, 0.1);
            color: var(--jameson-green);
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .postcode-validation {
            margin-top: 5px;
            font-size: 12px;
            color: var(--jameson-green);
        }
        
        .postcode-validation.error {
            color: #dc3545;
        }
        
        .postcode-validation.success {
            color: #28a745;
        }
        
        .postcode-validation.loading {
            color: var(--jameson-gold);
        }

        /* Email Frequency Slider */
        .frequency-slider-container {
            margin: 25px 0;
            text-align: center;
        }
        
        .frequency-slider {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
        }
        
        .frequency-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: var(--jameson-green);
        }
        
        .frequency-range {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            appearance: none;
            cursor: pointer;
        }
        
        .frequency-range::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--jameson-green);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .frequency-value {
            margin-top: 10px;
            font-weight: 600;
            color: var(--jameson-green);
        }
        
        /* Submit Button */
        .submit-container {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.95);
            padding-bottom: 40px;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, var(--jameson-green) 0%, var(--jameson-light-green) 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'jj2', Arial, sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(21, 71, 52, 0.3);
            min-width: 200px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(21, 71, 52, 0.4);
        }
        
        .submit-btn:active {
            transform: translateY(0);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.2rem;
            }
            
            .form-container {
                padding: 15px;
            }
            
            .container {
                padding: 8px;
            }
            
            .unified-card {
                padding: 20px;
            }
            
            .interests-grid {
                grid-template-columns: 1fr;
            }
            
            .question-title {
                font-size: 1.4rem;
            }

            /* Hide desktop DOB selects on mobile */
            .desktop-dob-selects {
                display: none !important;
            }

            /* Show mobile iOS picker on mobile */
            .picker-shell {
                display: flex !important;
                flex-direction: row;
                height: auto;
                padding: 16px;
                gap: 8px;
                max-width: 90vw;
                margin: 15px auto 25px auto;
                min-height: 200px;
                justify-content: center;
                align-items: center;
            }
            
            :root { 
                --picker-width: min(85vw, 320px); 
                --picker-height: auto; 
                --wheel-width: calc((100% - 40px) / 3);
                --item-height: 36px; 
                --visible-items: 3; 
            }
            
            .wheel {
                width: var(--wheel-width);
                height: calc(var(--item-height) * 3.5);
                margin: 0;
                flex-shrink: 0;
            }
            
            .divider {
                width: 1px;
                height: 60%;
                background: linear-gradient(to bottom, #0000, rgba(21, 71, 52, 0.2), #0000);
                margin: 0 4px;
                opacity: 0.7;
            }
            
            .selection-window {
                display: none;
            }
            
            .picker-footer {
                position: relative;
                bottom: auto;
                margin-top: 10px;
            }
            
            .wheel-list {
                padding: calc(var(--item-height) * 1.5) 0 calc(var(--item-height) * 1.2) 0;
            }
            
            .wheel-item {
                font-size: 14px !important;
                padding: 0 4px !important;
            }
            
            .wheel-item.center {
                font-weight: 700 !important;
                font-size: 16px !important;
                color: var(--accent) !important;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            }

            /* Stack location inputs vertically on mobile */
            .location-inputs-row {
                flex-direction: column;
                gap: 20px;
            }
            
            .postcode-container,
            .cities-input-container {
                flex: none;
                min-width: auto;
                width: 100%;
            }

            /* Mobile team grid */
            .teams-grid {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
                gap: 10px;
            }

            .team-card {
                height: 100px;
                padding: 10px 5px;
            }

            .team-card img {
                width: 30px;
                height: 30px;
            }

            .team-card .team-name {
                font-size: 0.75rem;
            }

            .league-tabs {
                gap: 5px;
            }

            .league-tab {
                padding: 8px 16px;
                font-size: 0.9rem;
            }

            /* Make email frequency slider circle bigger on mobile */
            .frequency-range::-webkit-slider-thumb {
                width: 30px;
                height: 30px;
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            }
        }
        
        @media (min-width: 769px) {
            /* Show desktop DOB selects on desktop */
            .desktop-dob-selects {
                display: block !important;
            }

            /* Hide mobile iOS picker on desktop */
            .picker-shell {
                display: none !important;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid var(--jameson-green);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">Welcome to Jameson</h1>
                <p class="hero-subtitle">Share your preferences for a personalized experience</p>
            </div>
        </div>
        
        <div class="form-container">
            
              %%[
SET @prefDE = "Jameson_UK_Welcome_Journey_Form_TESTT"
VAR @subscriberKey, @alias, @DOB, @birth_day, @birth_month, @birth_year
SET @subscriberKey = RequestParameter("cid")

SET @DOB = Lookup("ALL_CONTACTS_V3", "DOB", "ContactID", @subscriberKey)
SET @alias = Lookup("ALL_CONTACTS_V3", "alias", "ContactID", @subscriberKey)
SET @emailAddress = Lookup("ALL_CONTACTS_V3", "EmailAddress", "ContactID", @subscriberKey)
SET @firstName = Lookup("ALL_CONTACTS_V3", "FirstName", "ContactID", @subscriberKey)
SET @lastName = Lookup("ALL_CONTACTS_V3", "LastName", "ContactID", @subscriberKey)

SET @linkform = CloudPagesURL(4857, 'cid', @subscriberKey)
SET @linkunsub = CloudPagesURL(1728, 'alias', @alias, 'contactid', @subscriberKey)
SET @emailName = RequestParameter("emailName")
SET @competition = RequestParameter("competition")
VAR @prefRowset, @prefLength, @prewRow

IF NOT EMPTY(@DOB) THEN
  SET @birth_day = FormatDate(@DOB, "dd")
  SET @birth_month = FormatDate(@DOB, "MM")
  SET @birth_year = FormatDate(@DOB, "yyyy")
ENDIF

IF NOT EMPTY(@subscriberKey) THEN
  SET @prefRowset = LookupRows(@prefDE, "SubscriberKey", @subscriberKey)
  SET @prefLength = RowCount(@prefRowset)

  IF @prefLength > 0 THEN
    SET @prewRow = Row(@prefRowset, 1)

    IF EMPTY(@DOB) THEN
      SET @birth_day = Field(@prewRow, "birth_day")
      SET @birth_month = Field(@prewRow, "birth_month")
      SET @birth_year = Field(@prewRow, "birth_year")
    ENDIF

   
   SET @firstName = Field(@prewRow, "firstName")
   SET @lastName = Field(@prewRow, "lastName")
   SET @fav_football_team = Field(@prewRow, "fav_football_team")
   
    SET @city = Field(@prewRow, "nearest_city")
    SET @selectedCities = Field(@prewRow, "selected_cities")
    SET @postcode = Field(@prewRow, "postcode")
    SET @country = Field(@prewRow, "country")
    SET @interestFootball = Field(@prewRow, "interest_football")
    SET @interestFood = Field(@prewRow, "interest_food")
    SET @interestMusic = Field(@prewRow, "interest_music")
    SET @interestCocktails = Field(@prewRow, "interest_cocktails")
    SET @interestDistilleries = Field(@prewRow, "interest_distilleries")
    SET @interestWhiskey = Field(@prewRow, "interest_whiskey")
    SET @interestCompetition = Field(@prewRow, "interest_competitions")
    SET @interestMerchandise = Field(@prewRow, "interest_merchandise")
    SET @interestUltra = Field(@prewRow, "interest_ultra_premium_whisky")
    SET @interestKnowledge = Field(@prewRow, "interest_whisky_knowledge")
    SET @favFootball = Field(@prewRow, "fav_football_team")
    SET @occasionsMother = Field(@prewRow, "occasions_mothers_day")
    SET @occasionsFather = Field(@prewRow, "occasions_fathers_day")
    SET @occasionsChristmas = Field(@prewRow, "occasions_christmas")
    SET @occasionsHalloween = Field(@prewRow, "occasions_halloween")
    SET @occasionsValentines = Field(@prewRow, "occasions_valentines")
    SET @occasionsNone = Field(@prewRow, "occasions_none")
    SET @emailFrequency = Field(@prewRow, "email_frequency")
  ENDIF
ENDIF
]%%

    <div class="container">
       %%[IF NOT Empty(@subscriberKey) THEN]%%
        <form action="%%=CloudPagesURL(1111)=%%" method="POST" onsubmit="return validateForm()" id="preferenceForm">
            
            <!-- Unified Card containing all questions -->
            <div class="unified-card">
                
                <!-- Personal Information and Date of Birth Row -->
                <div class="row">
                    <!-- Personal Information Section - Left Column -->
                    <div class="col-md-6">
                        <div class="question-header" style="text-align: left; margin-bottom: 30px;">
                            <h2 class="question-title">Personal Information</h2>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" class="personal-info-input" id="firstName" value="%%=v(@firstName)=%%" name="firstName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="personal-info-input" id="lastName" value="%%=v(@lastName)=%%" name="lastName" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="emailAddress" class="form-label">Email Address</label>
                            <input type="email" class="personal-info-input" id="emailAddress" value="%%=v(@emailAddress)=%%" name="emailAddress" readonly style="background-color: #f8f9fa;">
                        </div>
                    </div>
                    
                    <!-- Date of Birth Section - Right Column -->
                    <div class="col-md-6">
                        <div class="question-header">
                            <h2 class="question-title">What's your date of birth?</h2>
                            <p class="question-subtitle" style="padding-bottom:10px;">Help us personalize your Jameson experience</p>
                        </div>
                        
                        <!-- Desktop Select Options for DOB -->
                        <div class="desktop-dob-selects">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="daySelect" class="form-label">Day</label>
                                    <select id="daySelect" class="ios-select">
                                        <option value="" disabled selected>Day</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="monthSelect" class="form-label">Month</label>
                                    <select id="monthSelect" class="ios-select">
                                        <option value="" disabled selected>Month</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="yearSelect" class="form-label">Year</label>
                                    <select id="yearSelect" class="ios-select">
                                        <option value="" disabled selected>Year</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- iOS Style Date Picker (Mobile Only) -->
                        <div class="picker-shell" role="application" aria-label="iOS style date picker">
                            <div class="wheel" id="wheel-day" aria-label="Day wheel" tabindex="0">
                                <ul class="wheel-list" id="list-day"></ul>
                            </div>
                            <div class="divider" aria-hidden="true"></div>
                            <div class="wheel" id="wheel-month" aria-label="Month wheel" tabindex="0">
                                <ul class="wheel-list" id="list-month"></ul>
                            </div>
                            <div class="divider" aria-hidden="true"></div>
                            <div class="wheel" id="wheel-year" aria-label="Year wheel" tabindex="0">
                                <ul class="wheel-list" id="list-year"></ul>
                            </div>

                            <div class="selection-window" aria-hidden="true"></div>
                        </div>

                        <!-- Hidden inputs for form submission -->
                        <div class="hidden-date-inputs">
                            <input type="hidden" id="birthday" name="birthday" required>
                            <input type="hidden" id="birthmonth" name="birthmonth" required>
                            <input type="hidden" id="birthyear" name="birthyear" required>
                        </div>
                    </div>
                </div>
                
                <hr class="question-divider">
                
                <!-- Location Section -->
                   <div class="question-header">
                    <h2 class="question-title">What's your postcode?</h2>
                    <p class="question-subtitle">Don't worry, we'll just use this to know where your nearest city is</p>
                </div>
                
                <!-- Postcode and Cities Input Row -->
                <div class="location-inputs-row">
                    <div class="postcode-container">
                        <label for="postcode" class="input-label">Postcode:</label>
                        <input 
                            type="text" 
                            id="postcode" 
                            name="postcode" 
                            class="location-input-field" 
                            placeholder="Enter your postcode"
                            value="%%=IIF(EMPTY(@postcode), '', @postcode)=%%"
                            maxlength="10"
                            oninput="validatePostcode(this.value)">
                        <div id="postcodeValidation" class="postcode-validation"></div>
                    </div>
                    
                    <div class="cities-input-container">
                        <label class="input-label">Cities you'd like to hear about</label>
                        <div class="autocomplete-container">
                            <input 
                                type="text" 
                                id="cityInput" 
                                class="location-input-field" 
                                placeholder="Max 3 Cities"
                                autocomplete="off">
                            <button type="button" class="add-city-btn" id="addCityBtn">ADD</button>
                            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                        </div>
                      <label class="input-label" style="margin-top:8px;">Max 3 Cities</label> 
                    <div class="selected-cities" id="selectedCities" >
                        %%[
                        IF NOT EMPTY(@selectedCities) THEN
                            SET @cityString = @selectedCities
                            
                            /* First city */
                            SET @firstComma = INDEXOF(@cityString, ",")
                            IF @firstComma > 0 THEN
                                SET @city1 = TRIM(SUBSTRING(@cityString, 1, SUBTRACT(@firstComma, 1)))
                                SET @remaining = SUBSTRING(@cityString, ADD(@firstComma, 1))
                            ELSE
                                SET @city1 = TRIM(@cityString)
                                SET @remaining = ""
                            ENDIF
                            
                            IF NOT EMPTY(@city1) THEN
                        ]%%
                        <div class="city-block">
                            <span>%%=v(@city1)=%%</span>
                            <button type="button" class="city-remove-btn" onclick="removeCity('%%=v(@city1)=%%')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        %%[
                            ENDIF
                            
                            /* Second city */
                            IF NOT EMPTY(@remaining) THEN
                                SET @secondComma = INDEXOF(@remaining, ",")
                                IF @secondComma > 0 THEN
                                    SET @city2 = TRIM(SUBSTRING(@remaining, 1, SUBTRACT(@secondComma, 1)))
                                    SET @remaining2 = SUBSTRING(@remaining, ADD(@secondComma, 1))
                                ELSE
                                    SET @city2 = TRIM(@remaining)
                                    SET @remaining2 = ""
                                ENDIF
                                
                                IF NOT EMPTY(@city2) THEN
                        ]%%
                        <div class="city-block">
                            <span>%%=v(@city2)=%%</span>
                            <button type="button" class="city-remove-btn" onclick="removeCity('%%=v(@city2)=%%')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        %%[
                                ENDIF
                                
                                /* Third city */
                                IF NOT EMPTY(@remaining2) THEN
                                    SET @city3 = TRIM(@remaining2)
                                    IF NOT EMPTY(@city3) THEN
                        ]%%
                        <div class="city-block">
                            <span>%%=v(@city3)=%%</span>
                            <button type="button" class="city-remove-btn" onclick="removeCity('%%=v(@city3)=%%')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        %%[
                                    ENDIF
                                ENDIF
                            ENDIF
                        ENDIF
                        ]%%
                    </div>
                   
                    </div>
                </div>
                
                <!-- Hidden inputs for location data -->
                <input type="hidden" id="selectedCitiesInput" name="selected_cities" value="">
                <input type="hidden" id="hiddenCity" name="city" value="%%=IIF(EMPTY(@city), '', @city)=%%">
                <input type="hidden" id="hiddenCountry" name="country" value="%%=IIF(EMPTY(@country), '', @country)=%%">
                
                <hr class="question-divider">

                <!-- Interests Section -->
                <div class="question-header">
                    <h2 class="question-title">What are your interests?</h2>
                    <p class="question-subtitle">(Select all that apply)</p>
                </div>
                
                <div class="interests-grid">
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestMusic == 'True', 'checked', '')=%% id="interest2" name="Music" type="checkbox" value="True">
                        <label class="interest-label" for="interest2">
                            <i class="fas fa-music"></i> <span>Music</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestFood == 'True', 'checked', '')=%% id="interest3" name="Food" type="checkbox" value="True">
                        <label class="interest-label" for="interest3">
                            <i class="fas fa-utensils"></i> <span>Food</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestCocktails == 'True', 'checked', '')=%% id="interest4" name="Cocktails" type="checkbox" value="True">
                        <label class="interest-label" for="interest4">
                            <i class="fas fa-cocktail"></i> <span>Cocktails</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestDistilleries == 'True', 'checked', '')=%% id="interest5" name="Distilleries" type="checkbox" value="True">
                        <label class="interest-label" for="interest5">
                            <i class="fas fa-industry"></i> <span>Our Distilleries</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestWhiskey == 'True', 'checked', '')=%% id="interest6" name="Whiskey" type="checkbox" value="True">
                        <label class="interest-label" for="interest6">
                            <i class="fas fa-glass-whiskey"></i> <span>Our Whiskey</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestCompetition == 'True', 'checked', '')=%% id="interest7" name="Competitions" type="checkbox" value="True">
                        <label class="interest-label" for="interest7">
                            <i class="fas fa-trophy"></i> <span>Competitions</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestMerchandise == 'True', 'checked', '')=%% id="interest8" name="Merchandise" type="checkbox" value="True">
                        <label class="interest-label" for="interest8">
                            <i class="fas fa-tshirt"></i> <span>Merchandise</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestUltra == 'True', 'checked', '')=%% id="interest9" name="Premium-Whiskey" type="checkbox" value="True">
                        <label class="interest-label" for="interest9">
                            <i class="fas fa-crown"></i> <span>Ultra-Premium Whiskey</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestKnowledge == 'True', 'checked', '')=%% id="interest10" name="Knowledge" type="checkbox" value="True">
                        <label class="interest-label" for="interest10">
                            <i class="fas fa-graduation-cap"></i> <span>Whiskey Knowledge</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="interest-checkbox" %%=IIF(@interestFootball == 'True', 'checked', '')=%% id="interest1" name="Football" onclick="toggleTeamFieldset()" type="checkbox" value="True">
                        <label class="interest-label" for="interest1">
                            <i class="fas fa-futbol"></i> <span>Football</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                </div>
                
                <!-- Football Team Selection with League Tabs -->
                <div id="teamFieldset" style="display:none;" class="mt-4">
                    <div class="question-header">
                        <h4 class="question-title" style="margin-bottom: 20px;">What's your favourite football team?</h4>
                    </div>
                    
                    <div class="league-selector">
                        <div class="league-tabs">
                            <button type="button" class="league-tab active" data-league="premier-league">Premier League</button>
                            <button type="button" class="league-tab" data-league="championship">Championship</button>
                            <button type="button" class="league-tab" data-league="league-one">League One</button>
                            <button type="button" class="league-tab" data-league="league-two">League Two</button>
                        </div>
                        
                        <div id="teamsContainer" class="teams-grid">
                            <!-- Teams will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Hidden input for selected team -->
                    <input type="hidden" id="team" name="team" value="">
                </div>
                
                <hr class="question-divider">

                <!-- Email Communication Preferences Section -->
                <div class="question-header">
                    <h2 class="question-title">Email Communication Preferences</h2>
                    <p class="question-subtitle">How often would you like to hear from us?</p>
                </div>
                
                <div class="frequency-slider-container">
                    <div class="frequency-slider">
                        <div class="frequency-labels">
                            <span>Rarely</span>
                            <span>Occasionally</span>
                            <span>Regularly</span>
                            <span>Always</span>
                        </div>
                        <input 
                            type="range" 
                            id="emailFrequency" 
                            name="email_frequency_range" 
                            class="frequency-range" 
                            min="1" 
                            max="4" 
                            value="%%=IIF(Empty(@emailFrequency), '3', IIF(@emailFrequency == 'Rarely', '1', IIF(@emailFrequency == 'Occasionally', '2', IIF(@emailFrequency == 'Regularly', '3', '4'))))=%%" 
                            oninput="updateFrequencyValue()">
                        <input type="hidden" id="emailFrequencyText" name="email_frequency" value="">
                        <div class="frequency-value" id="frequencyValue">%%=IIF(Empty(@emailFrequency), 'Regularly', @emailFrequency)=%%</div>
                    </div>
                </div>
                
                <hr class="question-divider">

                <!-- Communication Preferences (Occasions) Section -->
                <div class="question-header">
                    <h2 class="question-title">Opt-out Preferences</h2>
                    <p class="question-subtitle">On which of the following occasions would you <b><u>not</u></b> want to hear from us? (Select all that apply)</p>
                </div>
                
                <div class="interests-grid">
                    <div class="interest-item">
                        <input class="occasions-checkbox interest-checkbox" %%=IIF(@occasionsMother == 'True', 'checked', '')=%% id="occasions1" name="mother" type="checkbox" value="True" onclick="occasionOther()">
                        <label class="interest-label" for="occasions1">
                            <span>Mother's Day</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="occasions-checkbox interest-checkbox" %%=IIF(@occasionsFather == 'True', 'checked', '')=%% id="occasions2" name="father" type="checkbox" value="True" onclick="occasionOther()">
                        <label class="interest-label" for="occasions2">
                            <span>Father's Day</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="occasions-checkbox interest-checkbox" %%=IIF(@occasionsChristmas == 'True', 'checked', '')=%% id="occasions3" name="christmas" type="checkbox" value="True" onclick="occasionOther()">
                        <label class="interest-label" for="occasions3">
                            <span>Christmas</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="occasions-checkbox interest-checkbox" %%=IIF(@occasionsHalloween == 'True', 'checked', '')=%% id="occasions4" name="halloween" type="checkbox" value="True" onclick="occasionOther()">
                        <label class="interest-label" for="occasions4">
                            <span>Halloween</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="occasions-checkbox interest-checkbox" %%=IIF(@occasionsValentines == 'True', 'checked', '')=%% id="occasions5" name="valentine" type="checkbox" value="True" onclick="occasionOther()">
                        <label class="interest-label" for="occasions5">
                            <span>Valentine's Day</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                    <div class="interest-item">
                        <input class="occasions-checkbox interest-checkbox" %%=IIF(@occasionsNone == 'True', 'checked', '')=%% id="occasions6" name="none" type="checkbox" value="True" onclick="occasionNone()">
                        <label class="interest-label" for="occasions6">
                            <span>None of the above</span>
                            <i class="fas fa-check checkmark-icon"></i>
                        </label>
                    </div>
                </div>

            </div>

            <!-- Hidden Fields -->
            <input name="cid" type="hidden" value="%%=v(@subscriberKey)=%%">
            <input name="competition" type="hidden" value="%%=v(@competition)=%%">
            
            <!-- Submit -->
            <div class="submit-container">
                <button type="submit" class="submit-btn" id="submitBtn">
                     Submit Preferences
                </button>
            </div>
            
        </form>
        %%[ELSE]%%
        <div class="form-card text-center">
            <h2>An error occurred</h2>
            <p>Please try clicking the email link again.</p>
        </div>
        %%[ENDIF]%%
    </div>

            
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // UK Cities for autocomplete
        const ukCities = [
            'Aberdeen', 'Armagh', 'Bangor', 'Bath', 'Belfast', 'Birmingham', 'Bradford',
            'Brighton and Hove', 'Bristol', 'Cambridge', 'Canterbury', 'Cardiff', 'Carlisle',
            'Chelmsford', 'Chester', 'Chichester', 'Colchester', 'Coventry', 'Derby', 'Doncaster',
            'Dundee', 'Dunfermline', 'Durham', 'Edinburgh', 'Ely', 'Exeter',
            'Glasgow', 'Gloucester', 'Hereford', 'Inverness', 'Kingston upon Hull', 'Lancaster',
            'Leeds', 'Leicester', 'Lichfield', 'Lincoln', 'Lisburn', 'Liverpool', 'London',
            'Manchester', 'Milton Keynes', 'Newcastle upon Tyne', 'Newry', 'Newport', 'Norwich',
            'Nottingham', 'Oxford', 'Perth', 'Peterborough', 'Plymouth', 'Portsmouth',
            'Preston', 'Ripon', 'Salford', 'Salisbury', 'Sheffield', 'Southampton',
            'Southend-on-Sea', 'St Albans', 'St Asaph', 'St Davids', 'Stirling', 'Stoke-on-Trent',
            'Sunderland', 'Swansea', 'Truro', 'Wakefield', 'Wells', 'Westminster', 'Winchester',
            'Wolverhampton', 'Worcester', 'Wrexham', 'York'
        ];

        // Google Geocoding API Key
        const geocodingApiKey = 'XXXXXXXXX';

        // Check if mobile or desktop
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // Football Teams Data
        const leagueTeams = {
            'premier-league': [
                { id: 'AFC Bournemouth', name: 'AFC Bournemouth', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/d391959f-6cc4-4563-8733-04406382806b.png' },
                { id: 'Arsenal', name: 'Arsenal', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/1295cd7a-0e8e-467d-93c6-1e547c943840.png' },
                { id: 'Aston Villa', name: 'Aston Villa', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/130e5fa5-ca58-474d-a77c-0d3ffb67beb7.png' },
                { id: 'Brentford', name: 'Brentford FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/844ee7f8-5fc1-4e7e-a2f9-0c5917c323b9.png' },
                { id: 'Brighton & Hove Albion', name: 'Brighton', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/65c7caec-5935-4369-baf5-477fc905a690.png' },
                { id: 'Burnley', name: 'Burnley FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/785209e6-f499-4ec3-a519-10ecd67c7464.png' },
                { id: 'Chelsea', name: 'Chelsea', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/4599229f-f63d-4522-ba7b-6cd22c5c5d18.png' },
                { id: 'Crystal Palace', name: 'Crystal Palace', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/690cac69-0f87-4462-826c-560ec2f1fb1f.png' },
                { id: 'Everton', name: 'Everton', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/21ba87d4-85cf-474e-b4e7-1941ddc2d7e2.png' },
                { id: 'Fulham', name: 'Fulham', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/892d0ae1-32ea-41ae-ac36-5b771847d8b5.png' },
                { id: 'Leeds United', name: 'Leeds United', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/9f445589-9b23-4c25-9a09-7e1e6fd01578.png' },
                { id: 'Liverpool', name: 'Liverpool', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/ff390093-0a79-42ba-88d0-84859194b090.png' },
                { id: 'Manchester City', name: 'Manchester City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/fae54a6d-5ec9-4b9d-8f04-7914fdb44571.png' },
                { id: 'Manchester United', name: 'Manchester United', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/6fd904f5-2990-4367-b529-e7a786ccd79d.png' },
                { id: 'Newcastle United', name: 'Newcastle United', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/a3a2913f-7b57-45dd-8d11-40405290d808.png' },
                { id: 'Nottingham Forest', name: 'Nottingham Forest', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/5a3627bd-7c8c-469c-a234-a6f0e56d0cfe.png' },
                { id: 'Sunderland A.F.C.', name: 'Sunderland', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/667221c2-7b7b-4021-bde6-734366f21c86.png' },
                { id: 'Tottenham Hotspur', name: 'Tottenham Hotspur', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/d3a6d2e2-a40f-4c3f-ae4f-f7d73ad8678c.png' },
                { id: 'West Ham United', name: 'West Ham United', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/033f4560-72a6-44f5-ac1c-0de66017dca1.png' },
                { id: 'Wolverhampton Wanderers', name: 'Wolverhampton Wanderers', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/457ec493-6743-42d2-a7ab-ebb89e88eb9b.png' }
            ],
            'championship': [
                { id: 'Birmingham City', name: 'Birmingham City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/f3417640-5e67-4b57-851f-8536645f2694.png' },
                { id: 'Blackburn Rovers', name: 'Blackburn Rovers', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/a02a8ae5-adf2-4c35-acf8-1b11d135586a.png' },
                { id: 'Bristol City', name: 'Bristol City FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/933ff24c-0f26-4638-be38-78a5d8bb767c.png' },
                { id: 'Charlton Athletic', name: 'Charlton Athletic', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/264a3177-de46-4a0f-a80e-062adfc7a02b.png' },
                { id: 'Coventry City', name: 'Coventry City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/011ce89c-9b71-45ce-979b-85634ad86c6f.png' },
                { id: 'Derby County', name: 'Derby County', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/01896826-2152-4ff9-b9ef-7cb24783329b.png' },
                { id: 'Hull City', name: 'Hull City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/cbd74ff5-35b3-4f40-9742-bbf1944d3281.png' },
                { id: 'Ipswich Town', name: 'Ipswich Town', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/bacf2678-5a93-445f-9472-4a070871c186.png' },
                { id: 'Leicester City', name: 'Leicester City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/1f781a3e-83e8-491a-b4d4-9685866a48d9.png' },
                { id: 'Middlesbrough', name: 'Middlesbrough', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/1821ee68-2290-4787-8450-e4d8dba03faa.png' },
                { id: 'Millwall', name: 'Millwall FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/382b8708-bd41-48e4-92dd-be3bd3ffeac6.png' },
                { id: 'Norwich City', name: 'Norwich City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/df283c94-ff65-41a8-b291-0f80859131ca.png' },
                { id: 'Oxford United', name: 'Oxford United', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/8254ed61-de71-4d26-9949-e99f3ea69360.png' },
                { id: 'Portsmouth', name: 'Portsmouth FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/13e1a594-21a6-4803-a29e-8033df3fb4b4.png' },
                { id: 'Preston North End', name: 'Preston North End FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/e7e0d1b1-ab6c-48eb-92a2-deebcfb14c07.png' },
                { id: 'QPR', name: 'Queens Park Rangers', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/3451109d-ed7d-4926-9252-3ab529888256.png' },
                { id: 'Sheffield United', name: 'Sheffield United', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/20479d01-4f24-4603-8e96-e4f8c9eaf423.png' },
                { id: 'Sheffield Wednesday', name: 'Sheffield Wednesday', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/538273df-a3a8-4411-98b7-0adadb3ec852.png' },
                { id: 'Southampton', name: 'Southampton', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/0cdb4511-0e0c-4686-bbd0-b753e8a6df51.png' },
                { id: 'Stoke City', name: 'Stoke City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/be55c007-376f-4970-8ba7-40098eeb4235.png' },
                { id: 'Swansea City A.F.C.', name: 'Swansea City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/5604406a-f97c-47bd-8b3f-403a141641d6.png' },
                { id: 'Watford', name: 'Watford FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/b6920c88-df58-4ced-8402-bee6d533f65a.png' },
                { id: 'West Bromwich Albion', name: 'West Bromwich Albion', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/1e4476f1-a6ed-4856-bf94-4203ed71a45c.png' },
                { id: 'Wrexham A.F.C.', name: 'Wrexham AFC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/d38787c1-fc77-4e8a-8a92-aaa53a0a35ac.png' }
            ],
            'league-one': [
                { id: 'AFC Wimbledon', name: 'AFC Wimbledon', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/2ca064e3-94fd-4258-aef1-12e763fd798b.png' },
                { id: 'Barnsley', name: 'Barnsley', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/ec398200-4add-4f3f-8e44-4049390c9a5f.png' },
                { id: 'Blackpool', name: 'Blackpool FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/49b97c4e-868d-4e22-a31a-7b4fdae21199.png' },
                { id: 'Bolton Wanderers', name: 'Bolton Wanderers FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/f39c3b35-5b1c-4911-a436-25e29ae9467b.png' },
                { id: 'Bradford City', name: 'Bradford City FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/69fd22c8-7520-4fa8-8ba0-872076b4381b.png' },
                { id: 'Burton Albion', name: 'Burton Albion FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/7e978d61-67b0-49bc-ba2f-62ac4fe61d4e.png' },
                { id: 'Cardiff City', name: 'Cardiff City', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/e7c0e823-3f74-44ba-83c9-9d2319fea08b.png' },
                { id: 'Doncaster Rovers', name: 'Doncaster Rovers FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/48f2fa49-3795-4cbd-aa72-a9fc4f47faf4.png' },
                { id: 'Exeter City', name: 'Exeter City FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/5c5458a1-93df-4a3e-9743-81cb2ee7b5ea.png' },
                { id: 'Huddersfield Town', name: 'Huddersfield Town', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/67244225-cc5b-406f-bc02-c4fc4303b216.png' }
            ],
            'league-two': [
                { id: 'Accrington Stanley', name: 'Accrington <br>Stanley FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/fac4e3ce-1520-4eb5-9611-af1e79fa5aed.png' },
                { id: 'Barnet FC', name: 'Barnet FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/8128955b-40a2-4dc9-952b-718ea4dea946.png' },
                { id: 'Barrow AFC', name: 'Barrow AFC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/326a4db5-cfb6-4bce-a386-ce6bfb4804f1.png' },
                { id: 'Bristol Rovers', name: 'Bristol Rovers<br> FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/a8d75826-a63b-4827-9fe5-c76dd3f35ab2.png' },
                { id: 'Bromley', name: 'Bromley FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/19af8f67-cbd9-4796-912b-8f2d9aa27deb.png' },
                { id: 'Cambridge United', name: 'Cambridge<br> United FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/ace857aa-aee0-4f58-8c24-00faaf866e36.png' },
                { id: 'Cheltenham Town', name: 'Cheltenham <br>Town FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/be514530-22e3-4f36-a68d-fd71dd77cb87.png' },
                { id: 'Chesterfield', name: 'Chesterfield FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/7564f273-fc6e-46cc-a459-a2b850ea35c8.png' },
                { id: 'Colchester United', name: 'Colchester<br> United FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/d08a6980-1208-4610-9261-6005628df8cd.png' },
                { id: 'Crawley Town', name: 'Crawley Town <br>FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/d911f9bf-55a2-4df6-aac1-d969ece8c2c8.png' },
                { id: 'Crewe Alexandra', name: 'Crewe<br> Alexandra FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/6eb4f01f-befe-45d8-b6b1-e24dd7de1b0f.png' },
                { id: 'Fleetwood Town', name: 'Fleetwood Town<br> FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/489b02a8-b410-4e3d-9715-5d5a9d1ff55a.png' },
                { id: 'Gillingham', name: 'Gillingham FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/eb41a294-adf1-4adc-9017-6598769b1941.png' },
                { id: 'Grimsby Town', name: 'Grimsby Town <br>FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/df96cda9-d26e-44b7-ba4d-0801447a33a4.png' },
                { id: 'Harrogate Town', name: 'Harrogate Town', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/18a053df-0f26-48d4-bb0d-ee0b382f9212.png' },
                { id: 'Milton Keynes Dons FC', name: 'Milton Keynes <br>Dons FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/8bb83d8f-afcc-4e18-b454-d369a6ec2c77.png' },
                { id: 'Newport County', name: 'Newport County<br> AFC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/e98b0380-1119-4779-b6ca-6445a0f7bd14.png' },
                { id: 'Notts County', name: 'Notts County<br> FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/dbff4673-bcf8-4d62-9f28-1cb634da4f36.png' },
                { id: 'Oldham Athletic AFC', name: 'Oldham Athletic<br> AFC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/eef100c9-c2c5-4306-a5fd-8682a3c41193.png' },
                { id: 'Salford City', name: 'Salford City FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/d12dcf17-8b53-4e6e-b0aa-9bd9ce4311fc.png' },
                { id: 'Shrewsbury Town', name: 'Shrewsbury <br>Town FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/79a5608a-6f2f-4f6c-bbe1-c162fad1fa04.png' },
                { id: 'Swindon Town', name: 'Swindon Town', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/30cb7ae0-c2e0-4338-8be1-e2cddbba4e8d.png' },
                { id: 'Tranmere Rovers', name: 'Tranmere <br>Rovers FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/fa47e29b-e74b-4946-bb7a-964d8b567f53.png' },
                { id: 'Walsall', name: 'Walsall FC', img: 'https://image.email.pernod-ricard-uk.com/lib/fe8d12727d630d7c74/m/1/6b245adf-5694-450f-9c0e-0d97493a4c31.png' }
            ]
        };

        let selectedTeam = null;
        let currentLeague = 'premier-league';

        // iOS Date Picker Logic (Mobile)
        const itemH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--item-height')) || 40;
        const dayList = document.getElementById('list-day');
        const monthList = document.getElementById('list-month');
        const yearList = document.getElementById('list-year');

        const wheelDay = document.getElementById('wheel-day');
        const wheelMonth = document.getElementById('wheel-month');
        const wheelYear = document.getElementById('wheel-year');

        // Desktop select elements
        const daySelect = document.getElementById('daySelect');
        const monthSelect = document.getElementById('monthSelect');
        const yearSelect = document.getElementById('yearSelect');

        const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        const monthsShort = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        const now = new Date();
        const YEAR_RANGE = {start: now.getFullYear() - 100, end: now.getFullYear() - 18};

        // Preload all team images for faster loading
        function preloadTeamImages() {
            const allImages = [];
            
            // Collect all image URLs from all leagues
            Object.values(leagueTeams).forEach(teams => {
                teams.forEach(team => {
                    if (team.img && !allImages.includes(team.img)) {
                        allImages.push(team.img);
                    }
                });
            });
            
            // Preload images
            allImages.forEach(imageUrl => {
                const img = new Image();
                img.src = imageUrl;
            });
            
            console.log(`Preloaded ${allImages.length} team images`);
        }

        // Football Team Functions
        function initializeFootballTeams() {
            const leagueTabs = document.querySelectorAll('.league-tab');
            leagueTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    leagueTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Update current league and display teams
                    currentLeague = this.dataset.league;
                    displayTeams(currentLeague);
                });
            });
            
            // Initialize with Premier League teams
            displayTeams('premier-league');
        }

        function displayTeams(league) {
            const teamsContainer = document.getElementById('teamsContainer');
            const teams = leagueTeams[league];
            
            teamsContainer.innerHTML = '';
            
            teams.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.dataset.teamId = team.id;
                
                teamCard.innerHTML = `
                    <img src="${team.img}" alt="${team.name}" onerror="this.style.display='none'">
                    <div class="team-name">${team.name}</div>
                `;
                
                teamCard.addEventListener('click', function() {
                    // Remove selected class from all team cards
                    document.querySelectorAll('.team-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked team
                    this.classList.add('selected');
                    selectedTeam = team.id;
                    
                    // Update hidden input
                    document.getElementById('team').value = team.id;
                });
                
                teamsContainer.appendChild(teamCard);
            });
        }

        // Populate desktop select options
        function populateDesktopSelects() {
            // Populate days (1-31)
            daySelect.innerHTML = '<option value="" disabled selected>Day</option>';
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                daySelect.appendChild(option);
            }

            // Populate months
            monthSelect.innerHTML = '<option value="" disabled selected>Month</option>';
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = month;
                monthSelect.appendChild(option);
            });

            // Populate years
            yearSelect.innerHTML = '<option value="" disabled selected>Year</option>';
            for (let year = YEAR_RANGE.end; year >= YEAR_RANGE.start; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }

            // Add event listeners for desktop selects
            daySelect.addEventListener('change', updateDesktopDateInputs);
            monthSelect.addEventListener('change', updateDesktopDateInputs);
            yearSelect.addEventListener('change', updateDesktopDateInputs);
        }

        // Update hidden inputs when desktop selects change
        function updateDesktopDateInputs() {
            const day = daySelect.value;
            const month = monthSelect.value;
            const year = yearSelect.value;

            if (day && month && year) {
                document.getElementById('birthday').value = String(day).padStart(2, '0');
                document.getElementById('birthmonth').value = String(month).padStart(2, '0');
                document.getElementById('birthyear').value = year;
            }
        }

        // Set initial values for desktop selects
        function setDesktopInitialDate(year, month, day) {
            if (year && month && day) {
                daySelect.value = day;
                monthSelect.value = month;
                yearSelect.value = year;
                updateDesktopDateInputs();
            }
        }

        // Postcode validation function with geocoding
        async function validatePostcode(postcode) {
            const validationDiv = document.getElementById('postcodeValidation');
            const hiddenCity = document.getElementById('hiddenCity');
            const hiddenCountry = document.getElementById('hiddenCountry');
            
            // Clear previous validation
            validationDiv.innerHTML = '';
            validationDiv.className = 'postcode-validation';
            
            // Skip validation if postcode is empty
            if (!postcode.trim()) {
                hiddenCity.value = '';
                hiddenCountry.value = '';
                return;
            }
            
            // Basic UK postcode validation
            const ukPostcodeRegex = /^[A-Z]{1,2}[0-9R][0-9A-Z]? [0-9][A-Z]{2}$/i;
            if (!ukPostcodeRegex.test(postcode.replace(/\s+/g, ' ').trim())) {
                validationDiv.innerHTML = '<i class="fas fa-times-circle"></i> Invalid UK postcode format';
                validationDiv.className = 'postcode-validation error';
                hiddenCity.value = '';
                hiddenCountry.value = '';
                return;
            }
            
            // Show loading state
            validationDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Validating postcode...';
            validationDiv.className = 'postcode-validation loading';
            
            try {
                // Call Google Geocoding API
                const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(postcode)}&components=country:GB&key=${geocodingApiKey}`);
                const data = await response.json();
                
                if (data.status === 'OK' && data.results.length > 0) {
                    const result = data.results[0];
                    const addressComponents = result.address_components;
                    
                    // Extract city and country from address components
                    let city = '';
                    let country = '';
                    
                    // Look for city/town in different component types
                    for (const component of addressComponents) {
                        if (component.types.includes('locality') || 
                            component.types.includes('postal_town') || 
                            component.types.includes('administrative_area_level_2')) {
                            if (!city) city = component.long_name;
                        }
                        if (component.types.includes('country')) {
                            country = component.long_name;
                        }
                    }
                    
                    // Update hidden fields
                    hiddenCity.value = city;
                    hiddenCountry.value = country;
                    
                    // Show success message
                    validationDiv.innerHTML = `<i class="fas fa-check-circle"></i> Valid postcode - ${city ? city + ', ' : ''}${country}`;
                    validationDiv.className = 'postcode-validation success';
                    
                } else {
                    // Invalid postcode
                    validationDiv.innerHTML = '<i class="fas fa-times-circle"></i> Postcode not found';
                    validationDiv.className = 'postcode-validation error';
                    hiddenCity.value = '';
                    hiddenCountry.value = '';
                }
            } catch (error) {
                console.error('Geocoding error:', error);
                validationDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Unable to validate postcode';
                validationDiv.className = 'postcode-validation error';
                hiddenCity.value = '';
                hiddenCountry.value = '';
            }
        }

        function populateMonths(){
            monthList.innerHTML = '';
            // Use short month names on mobile for better fit
            const monthsToUse = isMobile() ? monthsShort : months;
            monthsToUse.forEach((m, i) => {
                const li = document.createElement('li');
                li.className = 'wheel-item';
                li.dataset.value = i + 1;
                li.textContent = m;
                monthList.appendChild(li);
            });
        }

        function populateYears(){
            yearList.innerHTML = '';
            for(let y = YEAR_RANGE.start; y <= YEAR_RANGE.end; y++){
                const li = document.createElement('li');
                li.className = 'wheel-item';
                li.dataset.value = y;
                li.textContent = y;
                yearList.appendChild(li);
            }
        }

        function daysInMonth(y, m){
            return new Date(y, m, 0).getDate();
        }

        function populateDays(year, month){
            const count = daysInMonth(year, month);
            dayList.innerHTML = '';
            for(let d=1; d<=count; d++){
                const li = document.createElement('li');
                li.className = 'wheel-item';
                li.dataset.value = d;
                li.textContent = d;
                dayList.appendChild(li);
            }
        }

        function scrollToIndex(wheel, index, smooth=true){
            const top = index * itemH;
            wheel.scrollTo({ top, behavior: smooth ? 'smooth' : 'auto' });
        }

        function nearestIndexFromScroll(wheel){
            return Math.round(wheel.scrollTop / itemH);
        }

        function attachSnap(wheel){
            let tid;
            wheel.addEventListener('scroll', () => {
                applyCenterHighlight(wheel);
                if(tid) clearTimeout(tid);
                tid = setTimeout(() => {
                    const idx = nearestIndexFromScroll(wheel);
                    scrollToIndex(wheel, idx, true);
                    applyCenterHighlight(wheel, true);
                    emitDateChange();
                }, 120);
            });
            
            wheel.addEventListener('keydown', (e) => {
                const idx = nearestIndexFromScroll(wheel);
                if(e.key === 'ArrowDown'){ 
                    e.preventDefault(); 
                    scrollToIndex(wheel, Math.min(idx + 1, wheel.querySelectorAll('.wheel-item').length -1)); 
                }
                if(e.key === 'ArrowUp'){ 
                    e.preventDefault(); 
                    scrollToIndex(wheel, Math.max(idx - 1, 0)); 
                }
            });
        }

        function applyCenterHighlight(wheel, final=false){
            const items = wheel.querySelectorAll('.wheel-item');
            const centerIdx = nearestIndexFromScroll(wheel);
            items.forEach((it, i) => {
                if(i === centerIdx) {
                    it.classList.add('center');
                    it.style.opacity = '1';
                } else {
                    it.classList.remove('center');
                    const dist = Math.abs(i - centerIdx);
                    it.style.opacity = (dist > 2) ? 0.3 : Math.max(0.4, 1 - (dist * 0.25));
                }
            });
            if(final) {
                const centered = items[centerIdx];
                if(centered) {
                    centered.classList.add('center');
                    centered.style.opacity = '1';
                }
            }
        }

        function getSelectedDate(){
            const dayIdx = nearestIndexFromScroll(wheelDay);
            const monthIdx = nearestIndexFromScroll(wheelMonth);
            const yearIdx = nearestIndexFromScroll(wheelYear);
            const dayEl = wheelDay.querySelectorAll('.wheel-item')[dayIdx];
            const monthEl = wheelMonth.querySelectorAll('.wheel-item')[monthIdx];
            const yearEl = wheelYear.querySelectorAll('.wheel-item')[yearIdx];
            return {
                day: dayEl ? parseInt(dayEl.dataset.value,10) : null,
                month: monthEl ? parseInt(monthEl.dataset.value,10) : null,
                monthName: monthEl ? monthEl.textContent : null,
                year: yearEl ? parseInt(yearEl.dataset.value,10) : null
            };
        }

        function adjustDaysIfNeeded(){
            const sel = getSelectedDate();
            if(!sel.year || !sel.month) return;
            const prevDay = sel.day || 1;
            const count = daysInMonth(sel.year, sel.month);
            if(prevDay > count){
                populateDays(sel.year, sel.month);
                scrollToIndex(wheelDay, count - 1, false);
            } else {
                populateDays(sel.year, sel.month);
                scrollToIndex(wheelDay, prevDay - 1, false);
            }
            applyCenterHighlight(wheelDay, true);
        }

        function emitDateChange(){
            const s = getSelectedDate();
            if(!s.year || !s.month || !s.day) return;
            const date = new Date(s.year, s.month - 1, s.day);
            
            // Update hidden form inputs
            document.getElementById('birthday').value = String(s.day).padStart(2, '0');
            document.getElementById('birthmonth').value = String(s.month).padStart(2, '0');
            document.getElementById('birthyear').value = s.year;
        }

        function setInitialDate(year = now.getFullYear() - 30, month = now.getMonth()+1, day = now.getDate()){
            // Ensure year is within valid range
            if (year > YEAR_RANGE.end) year = YEAR_RANGE.end;
            if (year < YEAR_RANGE.start) year = YEAR_RANGE.start;
            
            const yearIdx = YEAR_RANGE.end - year;
            const monthIdx = month - 1;
            const dayIdx = day - 1;
            
            // Add small delay to ensure elements are rendered
            setTimeout(() => {
                scrollToIndex(wheelYear, yearIdx, false);
                scrollToIndex(wheelMonth, monthIdx, false);
                populateDays(year, month);
                setTimeout(() => {
                    scrollToIndex(wheelDay, Math.min(dayIdx, wheelDay.querySelectorAll('.wheel-item').length -1), false);
                    applyCenterHighlight(wheelDay, true);
                    applyCenterHighlight(wheelMonth, true);
                    applyCenterHighlight(wheelYear, true);
                    emitDateChange();
                }, 50);
            }, 50);
        }

        // Initialize form on load
        window.onload = function() {
            // Check for pre-existing birth date values
            const birthDay = "%%=v(@birth_day)=%%";
            const birthMonth = "%%=v(@birth_month)=%%";
            const birthYear = "%%=v(@birth_year)=%%";

            // Initialize desktop selects
            populateDesktopSelects();

            // Initialize mobile iOS picker only if on mobile
            if (isMobile()) {
                populateMonths();
                populateYears();
                populateDays(now.getFullYear() - 30, now.getMonth() + 1);
                
                if (birthYear && birthMonth && birthDay) {
                    setInitialDate(parseInt(birthYear), parseInt(birthMonth), parseInt(birthDay));
                } else {
                    setInitialDate();
                }

                attachSnap(wheelDay);
                attachSnap(wheelMonth);
                attachSnap(wheelYear);

                wheelMonth.addEventListener('scroll', () => { debounceAdjust(); });
                wheelYear.addEventListener('scroll', () => { debounceAdjust(); });
            } else {
                // Set initial values for desktop selects
                if (birthYear && birthMonth && birthDay) {
                    setDesktopInitialDate(parseInt(birthYear), parseInt(birthMonth), parseInt(birthDay));
                }
            }

            // Initialize form fields with existing values
            initializeFormFields();
            
            // Initialize other components
            setupAutocomplete();
            initializeSelectedCities();
            updateFrequencyValue();
            toggleTeamFieldset();
            
            // Preload team images for instant loading
            preloadTeamImages();
            initializeFootballTeams();
            
            // Initialize postcode validation if there's an existing value
            const existingPostcode = document.getElementById('postcode').value;
            if (existingPostcode.trim()) {
                validatePostcode(existingPostcode);
            }
        };

        let adjTid;
        function debounceAdjust(){
            if(adjTid) clearTimeout(adjTid);
            adjTid = setTimeout(() => {
                adjustDaysIfNeeded();
                emitDateChange();
            }, 160);
        }

        // City selection functionality
        let selectedCities = [];
        const maxCities = 3;
        
        function setupAutocomplete() {
            const cityInput = document.getElementById('cityInput');
            const dropdown = document.getElementById('autocompleteDropdown');
            const addBtn = document.getElementById('addCityBtn');
            
            // Show dropdown when typing (minimum 1 character)
            cityInput.addEventListener('input', function() {
                const value = this.value.toLowerCase().trim();
                console.log('Autocomplete input event:', value);
                dropdown.innerHTML = '';
                
                // Always show dropdown if there's any input
                if (value.length >= 1) {
                    // Get current selected cities from DOM
                    const currentCities = Array.from(document.querySelectorAll('#selectedCities .city-block span'))
                        .map(span => span.textContent.trim());
                    
                    // Filter cities that START with the typed letters
                    const matches = ukCities.filter(city => 
                        city.toLowerCase().startsWith(value) && 
                        !currentCities.includes(city)
                    ).slice(0, 8);
                    
                    // Always show dropdown, even if no matches
                    dropdown.innerHTML = ''; // Clear previous items
                    
                    if (matches.length > 0) {
                        matches.forEach(city => {
                            const item = document.createElement('div');
                            item.className = 'autocomplete-item';
                            item.textContent = city;
                            item.onclick = () => selectCityFromDropdown(city);
                            dropdown.appendChild(item);
                        });
                    } else {
                        // Show "No matches" message
                        const noMatchItem = document.createElement('div');
                        noMatchItem.className = 'autocomplete-item';
                        noMatchItem.textContent = 'No matching cities found';
                        noMatchItem.style.color = '#999';
                        noMatchItem.style.fontStyle = 'italic';
                        noMatchItem.style.cursor = 'default';
                        noMatchItem.onclick = null; // Prevent clicking
                        dropdown.appendChild(noMatchItem);
                    }
                    
                    // Always show dropdown
                    dropdown.style.display = 'block';
                    dropdown.style.visibility = 'visible';
                    dropdown.style.opacity = '1';
                    dropdown.style.zIndex = '9999';
                } else {
                    dropdown.style.display = 'none';
                }
                
                // Update ADD button state
                updateAddButtonState();
            });
            
            // Show dropdown when input is focused
            cityInput.addEventListener('focus', function() {
                console.log('Input focused');
                const dropdown = document.getElementById('autocompleteDropdown');
                const value = this.value.toLowerCase().trim();
                
                // Show all cities if input is empty, or filter if there's text
                dropdown.innerHTML = '';
                const filteredCities = ukCities.filter(city => 
                    city.toLowerCase().includes(value)
                );
                
                if (filteredCities.length > 0) {
                    filteredCities.forEach(city => {
                        const item = document.createElement('div');
                        item.className = 'autocomplete-item';
                        item.textContent = city;
                        item.onclick = () => selectCityFromDropdown(city);
                        dropdown.appendChild(item);
                    });
                    
                    dropdown.style.display = 'block';
                    dropdown.style.zIndex = '9999';
                }
            });
            
            // ADD button functionality
            addBtn.addEventListener('click', function() {
                const value = cityInput.value.trim();
                
                // Get current cities from DOM
                const currentCities = Array.from(document.querySelectorAll('#selectedCities .city-block span'))
                    .map(span => span.textContent.trim());
                const currentCityCount = currentCities.length;
                
                if (value && currentCityCount < maxCities) {
                    // Check if it's a valid UK city that starts with input
                    const matchingCity = ukCities.find(city => 
                        city.toLowerCase().startsWith(value.toLowerCase()) &&
                        !currentCities.includes(city)
                    );
                    
                    if (matchingCity) {
                        addCity(matchingCity);
                    }
                }
            });
            
            // Enter key to add city
            cityInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addBtn.click();
                }
            });
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.autocomplete-container')) {
                    dropdown.style.display = 'none';
                }
            });
        }
        
        function selectCityFromDropdown(city) {
            const cityInput = document.getElementById('cityInput');
            const dropdown = document.getElementById('autocompleteDropdown');
            
            // Add the city directly instead of just filling the input
            addCity(city);
            
            // Clear the input and hide dropdown
            cityInput.value = '';
            dropdown.style.display = 'none';
            updateAddButtonState();
        }
        
        function updateAddButtonState() {
            const addBtn = document.getElementById('addCityBtn');
            
            // Count current cities from DOM
            const currentCityCount = document.querySelectorAll('#selectedCities .city-block').length;
            
            // Simply check if there's space for more cities
            const canAdd = currentCityCount < maxCities;
            
            addBtn.disabled = !canAdd;
            console.log('Add button state:', canAdd ? 'enabled' : 'disabled', 'City count:', currentCityCount, 'Max:', maxCities);
        }
        
        function addCity(city) {
            // Get current cities from DOM
            const currentCities = Array.from(document.querySelectorAll('#selectedCities .city-block span'))
                .map(span => span.textContent.trim());
            const currentCityCount = currentCities.length;
            
            // Check if we can add the city
            if (currentCityCount >= maxCities || currentCities.includes(city)) {
                return;
            }
            
            // Create new city block and add to DOM
            const container = document.getElementById('selectedCities');
            const cityBlock = document.createElement('div');
            cityBlock.className = 'city-block';
            cityBlock.innerHTML = `
                <span>${city}</span>
                <button type="button" class="city-remove-btn" onclick="removeCity('${city}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(cityBlock);
            
            // Update hidden input and UI state
            updateSelectedCitiesInput();
            
            // Clear input
            const cityInput = document.getElementById('cityInput');
            cityInput.value = '';
            document.getElementById('autocompleteDropdown').style.display = 'none';
            updateAddButtonState();
        }
        
        function removeCity(city) {
            // Remove from JavaScript array
            const index = selectedCities.indexOf(city);
            if (index > -1) {
                selectedCities.splice(index, 1);
            }
            
            // Also remove from DOM (for server-rendered cities)
            const cityBlocks = document.querySelectorAll('#selectedCities .city-block');
            cityBlocks.forEach(block => {
                const citySpan = block.querySelector('span');
                if (citySpan && citySpan.textContent.trim() === city) {
                    block.remove();
                }
            });
            
            // Update everything
            updateSelectedCitiesInput();
            updateAddButtonState();
        }
        
        function updateSelectedCitiesDisplay() {
            const container = document.getElementById('selectedCities');
            container.innerHTML = '';
            
            selectedCities.forEach(city => {
                const cityBlock = document.createElement('div');
                cityBlock.className = 'city-block';
                cityBlock.innerHTML = `
                    <span>${city}</span>
                    <button type="button" class="city-remove-btn" onclick="removeCity('${city}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(cityBlock);
            });
        }
        
        function updateSelectedCitiesInput() {
            // Get current cities from DOM
            const currentCities = Array.from(document.querySelectorAll('#selectedCities .city-block span'))
                .map(span => span.textContent.trim());
            
            // Sync JavaScript array with DOM
            selectedCities.length = 0; // Clear array
            selectedCities.push(...currentCities); // Add current DOM cities
            
            document.getElementById('selectedCitiesInput').value = currentCities.join(',');
        }

        // Initialize form fields with existing values
        function initializeFormFields() {
            try {
                // Initialize basic form fields
                const firstName = "%%=v(@firstName)=%%";
                const lastName = "%%=v(@lastName)=%%";
                const postcode = "%%=v(@postcode)=%%";
                const country = "%%=v(@country)=%%";
                const team = "%%=v(@fav_football_team)=%%";
                const emailFrequency = "%%=v(@emailFrequency)=%%";

                if (firstName && firstName.trim() !== '') {
                    const firstNameEl = document.getElementById('firstName');
                    if (firstNameEl) firstNameEl.value = firstName;
                }
                if (lastName && lastName.trim() !== '') {
                    const lastNameEl = document.getElementById('lastName');
                    if (lastNameEl) lastNameEl.value = lastName;
                }
                if (postcode && postcode.trim() !== '') {
                    const postcodeEl = document.getElementById('postcode');
                    if (postcodeEl) postcodeEl.value = postcode;
                }
                if (country && country.trim() !== '') {
                    const countryEl = document.getElementById('country');
                    if (countryEl) countryEl.value = country;
                }
                
                // Initialize football team with smart league detection
                if (team && team.trim && team.trim() !== '') {
                    console.log('Initializing team:', team);
                    setTimeout(() => {
                        initializeFootballTeam(team.trim());
                    }, 500); // DOM yüklenmesi için delay
                }
                
                // Initialize email frequency slider
                if (emailFrequency && typeof emailFrequency === 'string' && emailFrequency.trim() !== '') {
                    const frequencies = ['Rarely', 'Occasionally', 'Regularly', 'Always'];
                    const frequencyIndex = frequencies.indexOf(emailFrequency);
                    if (frequencyIndex !== -1) {
                        const sliderEl = document.getElementById('emailFrequency');
                        if (sliderEl) sliderEl.value = frequencyIndex + 1;
                    }
                }
            } catch (error) {
                console.error('Error initializing form fields:', error);
            }
        }

        // Smart football team initialization
        function initializeFootballTeam(teamName) {
            console.log('=== INITIALIZING FOOTBALL TEAM ===');
            console.log('Looking for team:', teamName);
            console.log('Team type:', typeof teamName);
            console.log('Team length:', teamName?.length);
            
            // 1. Hangi league'de bu takım var?
            const targetLeague = findTeamInLeagues(teamName);
            if (!targetLeague) {
                console.warn('Team not found in any league:', teamName);
                console.log('Available teams in all leagues:');
                for (const [leagueName, teams] of Object.entries(leagueTeams)) {
                    console.log(`${leagueName}:`, teams.map(t => t.name || t.id));
                }
                return;
            }
            
            console.log('Team found in league:', targetLeague);
            
            // 2. Doğru league'i aktif yap
            switchToLeague(targetLeague);
            
            // 3. Takımı seç - timing'i artıralım
            setTimeout(() => {
                console.log('Attempting to select team after league switch...');
                selectTeamCard(teamName);
            }, 500); // 200'den 500'e çıkardım
        }
        
        function findTeamInLeagues(teamName) {
            console.log('findTeamInLeagues - searching for:', teamName);
            // Tüm league'lerde takımı ara
            for (const [leagueName, teams] of Object.entries(leagueTeams)) {
                console.log(`Searching in ${leagueName}:`, teams.map(t => t.name || t.id));
                const found = teams.find(team => {
                    const matches = team.id === teamName || 
                                   team.name === teamName ||
                                   team.id.toLowerCase() === teamName.toLowerCase() ||
                                   (team.name && team.name.toLowerCase() === teamName.toLowerCase());
                    
                    if (matches) {
                        console.log('MATCH FOUND:', {
                            searchFor: teamName,
                            foundTeam: team,
                            league: leagueName
                        });
                    }
                    return matches;
                });
                if (found) {
                    return leagueName;
                }
            }
            console.log('No team found in any league for:', teamName);
            return null;
        }
        
        function switchToLeague(leagueName) {
            // League tab'ları güncelle
            document.querySelectorAll('.league-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.league === leagueName) {
                    tab.classList.add('active');
                }
            });
            
            // Teams container'ı yenile
            displayTeams(leagueName);
        }
        
        function selectTeamCard(teamName) {
            console.log('selectTeamCard called with:', teamName);
            
            // Mevcut selection'ı temizle
            document.querySelectorAll('.team-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Mevcut tüm team card'ları listele
            const allCards = document.querySelectorAll('.team-card');
            console.log('Available team cards:', Array.from(allCards).map(card => ({
                dataTeamId: card.dataset.teamId,
                text: card.textContent?.trim()
            })));
            
            // Doğru team card'ı bul ve seç - multiple selector deneme
            let targetCard = document.querySelector(`[data-team-id="${teamName}"]`);
            
            // Eğer bulunamadıysa, farklı selector'lar dene
            if (!targetCard) {
                console.log('First selector failed, trying alternative methods...');
                
                // Exact text match dene
                allCards.forEach(card => {
                    const cardText = card.querySelector('.team-name')?.textContent?.trim();
                    if (cardText === teamName) {
                        targetCard = card;
                        console.log('Found by text match:', cardText);
                    }
                });
                
                // Case insensitive dene
                if (!targetCard) {
                    allCards.forEach(card => {
                        const cardText = card.querySelector('.team-name')?.textContent?.trim();
                        if (cardText?.toLowerCase() === teamName.toLowerCase()) {
                            targetCard = card;
                            console.log('Found by case insensitive match:', cardText);
                        }
                    });
                }
            }
            
            if (targetCard) {
                targetCard.classList.add('selected');
                console.log('Team card successfully selected:', teamName);
                
                // selectedTeam variable'ını güncelle
                selectedTeam = teamName;
                console.log('selectedTeam variable updated with:', teamName);
                
                // Hidden input'u güncelle
                const hiddenInput = document.getElementById('team');
                if (hiddenInput) {
                    hiddenInput.value = teamName;
                    console.log('Hidden input updated with:', teamName);
                }
            } else {
                console.error('Team card not found with any method for:', teamName);
                console.log('Available teams in current view:', Array.from(allCards).map(card => card.dataset.teamId));
            }
        }

        // Initialize city selection from existing data
        function initializeSelectedCities() {
            // Check if cities are already rendered in HTML (server-side)
            const renderedCityBlocks = document.querySelectorAll('#selectedCities .city-block span');
            if (renderedCityBlocks.length > 0) {
                // Cities are already rendered by server, just populate the JavaScript array
                renderedCityBlocks.forEach(span => {
                    const cityName = span.textContent.trim();
                    if (ukCities.includes(cityName) && selectedCities.length < maxCities) {
                        selectedCities.push(cityName);
                    }
                });
            } else {
                // Fallback to JavaScript-based initialization if no server-rendered cities
                const existingSelectedCities = "%%=v(@selectedCities)=%%";
                const existingCity = "%%=v(@city)=%%";
                
                // First try to get from selected_cities field
                if (existingSelectedCities && existingSelectedCities.trim() !== '') {
                    const cities = existingSelectedCities.split(',').map(c => c.trim()).filter(c => c);
                    cities.forEach(city => {
                        if (ukCities.includes(city) && selectedCities.length < maxCities) {
                            selectedCities.push(city);
                        }
                    });
                }
                // Fallback to nearest_city field for backward compatibility
                else if (existingCity && existingCity.trim() !== '') {
                    const cities = existingCity.split(',').map(c => c.trim()).filter(c => c);
                    cities.forEach(city => {
                        if (ukCities.includes(city) && selectedCities.length < maxCities) {
                            selectedCities.push(city);
                        }
                    });
                }
                
                if (selectedCities.length > 0) {
                    updateSelectedCitiesDisplay();
                }
            }
            
            // Always update the hidden input with current selection
            updateSelectedCitiesInput();
        }

        // Email frequency slider
        function updateFrequencyValue() {
            const slider = document.getElementById('emailFrequency');
            const valueDisplay = document.getElementById('frequencyValue');
            const value = parseInt(slider.value);
            
            const frequencies = ['Rarely', 'Occasionally', 'Regularly', 'Always'];
            const frequencyText = frequencies[value - 1];
            
            valueDisplay.textContent = frequencyText;
            
            // Text değerini hidden input'a yaz
            document.getElementById('emailFrequencyText').value = frequencyText;
        }

        // Football team fieldset
        function toggleTeamFieldset() {
            const footballCheckbox = document.getElementById("interest1");
            const teamFieldset = document.getElementById("teamFieldset");
            
            if (footballCheckbox.checked) {
                teamFieldset.style.display = "block";
            } else {
                teamFieldset.style.display = "none";
                // Clear team selection when hiding
                selectedTeam = null;
                document.getElementById('team').value = '';
                document.querySelectorAll('.team-card').forEach(card => {
                    card.classList.remove('selected');
                });
            }
        }

        // Occasions none handler
        function occasionNone() {
            const noneCheckbox = document.getElementById("occasions6");
            const occasionCheckboxes = document.querySelectorAll('input[id^="occasions"]:not(#occasions6)');
            
            if (noneCheckbox.checked) {
                occasionCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
            }
        }
        
        // Handler for other occasion checkboxes
        function occasionOther() {
            const noneCheckbox = document.getElementById("occasions6");
            const occasionCheckboxes = document.querySelectorAll('input[id^="occasions"]:not(#occasions6)');
            
            // Check if any other occasion is selected
            const anyOtherSelected = Array.from(occasionCheckboxes).some(checkbox => checkbox.checked);
            
            // If any other occasion is selected, uncheck "None of the above"
            if (anyOtherSelected && noneCheckbox.checked) {
                noneCheckbox.checked = false;
            }
        }

        // Form validation
        function validateForm() {
            const interestsCheckboxes = document.querySelectorAll('input[id^="interest"]');
            const occasionsCheckboxes = document.querySelectorAll('input[id^="occasions"]');
            
            let isInterestsChecked = false;
            let isOccasionsChecked = false;
            
            // Check if at least one interest is selected
            for (let i = 0; i < interestsCheckboxes.length; i++) {
                if (interestsCheckboxes[i].checked) {
                    isInterestsChecked = true;
                    break;
                }
            }
            
            // Check if at least one occasion is selected
            for (let i = 0; i < occasionsCheckboxes.length; i++) {
                if (occasionsCheckboxes[i].checked) {
                    isOccasionsChecked = true;
                    break;
                }
            }
            
            // Validate cities selection (optional but recommended)
            if (selectedCities.length === 0) {
                const confirmSubmit = confirm("You haven't selected any cities. Are you sure you want to continue without location preferences?");
                if (!confirmSubmit) {
                    document.getElementById('cityInput').scrollIntoView({ behavior: 'smooth' });
                    document.getElementById('cityInput').focus();
                    return false;
                }
            }
            
            if (!isInterestsChecked) {
                alert("Please select at least one interest.");
                document.getElementById('interest1').scrollIntoView({ behavior: 'smooth' });
                return false;
            }
            
            if (!isOccasionsChecked) {
                alert("Please select at least one occasion preference.");
                document.getElementById('occasions1').scrollIntoView({ behavior: 'smooth' });
                return false;
            }
            
            // Validate football team if football is selected
            const footballCheckbox = document.getElementById("interest1");
            if (footballCheckbox.checked && !selectedTeam) {
                alert("Please select your favourite football team.");
                document.getElementById('teamFieldset').scrollIntoView({ behavior: 'smooth' });
                return false;
            }
            
            // Update cities input before submission
            updateSelectedCitiesInput();
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            submitBtn.disabled = true;
            
            return true;
        }

        // Fine-tune center on resize
        window.addEventListener('resize', () => {
            if (isMobile()) {
                applyCenterHighlight(wheelDay, true);
                applyCenterHighlight(wheelMonth, true);
                applyCenterHighlight(wheelYear, true);
            }
        });
    </script>
</body>
</html>
